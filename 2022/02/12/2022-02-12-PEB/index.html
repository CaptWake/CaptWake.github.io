<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Understanding the Windows PEB - Personal Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Personal Blog"><meta name="msapplication-TileImage" content="/images/favicons/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Personal Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="During malware analysis, I often encounter shellcode that abuse the PEB structure to dinamically constructs it&amp;#39;s own import table..."><meta property="og:type" content="blog"><meta property="og:title" content="Understanding the Windows PEB"><meta property="og:url" content="http://example.com/2022/02/12/2022-02-12-PEB/"><meta property="og:site_name" content="Personal Blog"><meta property="og:description" content="During malware analysis, I often encounter shellcode that abuse the PEB structure to dinamically constructs it&amp;#39;s own import table..."><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:published_time" content="2022-02-12T00:00:00.000Z"><meta property="article:modified_time" content="2023-08-22T17:03:15.283Z"><meta property="article:author" content="Stefano De Rosa"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2022/02/12/2022-02-12-PEB/"},"headline":"Understanding the Windows PEB","image":["http://example.com/img/og_image.png"],"datePublished":"2022-02-12T00:00:00.000Z","dateModified":"2023-08-22T17:03:15.283Z","author":{"@type":"Person","name":"Stefano De Rosa"},"publisher":{"@type":"Organization","name":"Personal Blog","logo":{"@type":"ImageObject","url":"http://example.com/images/favicons/favicon-16x16.png"}},"description":"During malware analysis, I often encounter shellcode that abuse the PEB structure to dinamically constructs it&#39;s own import table..."}</script><link rel="canonical" href="http://example.com/2022/02/12/2022-02-12-PEB/"><link rel="icon" href="/images/favicons/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicons/favicon-16x16.png" alt="Personal Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/CaptWake"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-3 is-size-4-mobile">Understanding the Windows PEB</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-alt"></i> <span class="level-item"><time dateTime="2022-02-12T00:00:00.000Z" title="2/12/2022, 12:00:00 AM"> 2022-02-12</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/categories/Windows-Internals/">Windows Internals</a></span><span class="level-item"><i class="far fa-clock"></i>  11 minutes read</span></div></div><div class="content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>During malware analysis, I often encounter shellcode that abuse the PEB structure to dinamically constructs it’s own import table.</p>
<p>The PEB (Process Environment Block), according to <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb">MSDN</a> is a structure that contains process informations, but I prefer <a target="_blank" rel="noopener" href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/api/pebteb/peb/index.htm">Geoff Chapell’s definition</a> that describe the PEB structure like a process’s user-mode representation created by the kernel and managed mostly in user mode, and in practice is used to share data between processes instead of creating an inter-process-communication (IPC).</p>
<p>PEB has been present in Windows since the introduction of Win2k.</p>
<h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h2><p>In all recent Win x86 versions, the FS register points to the TEB (Thread Environment Block) structure defined in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-teb">Winternl.h</a> like a structure that contains the running thread’s informations similarly like PEB, and also visible using the public avaiable microsoft debug symbols.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_TEB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> NtTib            : _NT_TIB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> EnvironmentPointer : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x020</span> ClientId         : _CLIENT_ID</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x028</span> ActiveRpcHandle  : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> ThreadLocalStoragePointer : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x030</span> ProcessEnvironmentBlock : Ptr32 _PEB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> LastErrorValue   : Uint4B</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x038</span> CountOfOwnedCriticalSections : Uint4B</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x03c</span> CsrClientThread  : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x040</span> Win32ThreadInfo  : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x044</span> User32Reserved   : [<span class="number">26</span>] Uint4B</span><br><span class="line"></span><br><span class="line">   ...  &lt;more&gt;   ...</span><br></pre></td></tr></table></figure>

<p>For all recents x64 windows version, the GS register stores the TEB address, you may wondering if these segment registers have some processor-defined purpose like CS (Code Segment) DS (Data Segment) ES(Destination Segment), the answer is no, but instead are given purpose by the OS’s running, also their name was chosen to continue the alphabetic order😂.</p>
<p><em>For more informations about the background history behind this read this interesting <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10810203/what-is-the-fs-gs-register-intended-for#:~:text=The%20registers%20FS%20and%20GS,to%20access%20thread%2Dspecific%20memory.">SO thread</a>.</em></p>
<p>Now if you looked at the TEB structure above you may noticed that at offset 0x30 there is a pointer to a _PEB structure, let’s take a look at this structure.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_PEB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> InheritedAddressSpace : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x001</span> ReadImageFileExecOptions : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x002</span> BeingDebugged    : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> BitField         : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> ImageUsesLargePages : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsProtectedProcess : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsImageDynamicallyRelocated : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> SkipPatchingUser32Forwarders : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsPackagedProcess : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsAppContainer   : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsProtectedProcessLight : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsLongPathAwareProcess : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x004</span> Mutant           : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> ImageBaseAddress : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x00c</span> Ldr              : Ptr32 _PEB_LDR_DATA</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x010</span> ProcessParameters : Ptr32 _RTL_USER_PROCESS_PARAMETERS</span><br><span class="line"></span><br><span class="line">   ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p>You can see a lot of important informations about the process i.e. the <code>BeingDebugged</code> field is used a lot from malware to avoid common dinamical analysis techniques that use the function <code>IsDebuggerPresent()</code> to check if the program is debugged, this function reversed using ghidra generates the following pseudocode:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ulonglong <span class="title function_">IsDebuggerPresent</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  longlong in_GS_OFFSET;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (ulonglong)*(byte *)(*(longlong *)(in_GS_OFFSET + <span class="number">0x60</span>) + <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The program that I wrote below, in an x86 environment, does the same thing without importing the Kernel32.dll function in order to hide from static analysis of the import table.</p>
<script src="https://gist.github.com/CaptWake/fbaf238bea17299bc65edcf94153591d.js"></script>

<p>Becoming familiar with this structure is important because a lot of Windows functions just read the PEB and TEB informations, and you can use these structure to obfuscate code or to simply avoid additional dependencies.</p>
<p>Another interesting field is the <code>Ldr</code> located at offset 0xC, this is a pointer to a <code>_PEB_LDR_DATA</code> data structure that contains information about the loaded modules for the process, shellcode will typically walk this data structure to find the base address of loaded dlls.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_PEB_LDR_DATA</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> Length           : Uint4B</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x004</span> Initialized      : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> SsHandle         : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x00c</span> InLoadOrderModuleList : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x014</span> InMemoryOrderModuleList : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> InInitializationOrderModuleList : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x024</span> EntryInProgress  : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x028</span> ShutdownInProgress : UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> ShutdownThreadId : Ptr32 Void</span><br></pre></td></tr></table></figure>

<p>According to <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data">microsoft docs</a> the field <code>InMemoryOrderModuleList</code> represents the head of a doubly-linked list where each items in the list is a pointer to a <code>LDR_DATA_TABLE_ENTRY</code> data structure.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_LDR_DATA_TABLE_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> InLoadOrderLinks : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> InMemoryOrderLinks : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x010</span> InInitializationOrderLinks : _LIST_ENTRY</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x018</span> DllBase          : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> EntryPoint       : Ptr32 Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x020</span> SizeOfImage      : Uint4B</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x024</span> FullDllName      : _UNICODE_STRING</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> BaseDllName      : _UNICODE_STRING</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> FlagGroup        : [<span class="number">4</span>] UChar</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> Flags            : Uint4B</span><br><span class="line"></span><br><span class="line">   ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p>You may wondering why there are 3 double-linked lists, the response is that theoretically they should represent different things as their names suggest but in reality they are equals, these lists are defined following the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/ntdef/ns-ntdef-list_entry">MSDN</a>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span> &#123;</span></span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span> *<span class="title">Flink</span>;</span></span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span> *<span class="title">Blink</span>;</span></span><br><span class="line"></span><br><span class="line">&#125; LIST_ENTRY, *PLIST_ENTRY, *RESTRICTED_POINTER PRLIST_ENTRY;</span><br></pre></td></tr></table></figure>

<p>Assuming a 32bit environment we can see that these struct has an 8byte size, why we need to know this? Because if we choose to use the <code>InMemoryOrderLinks</code> list when we follow this pointer it’s taking us to <code>_LIST_ENTRY</code> structure <code>InMemoryOrderLinks</code> of the <code>_LDR_DATA_TABLE_ENTRY</code> of the next module that isn’t the base of the structure, for this reason we need to subtract 8 bytes from that address in order to point correctly at the <code>_LDR_DATA_TABLE_ENTRY</code> struct.</p>
<h2 id="Case-Study"><a href="#Case-Study" class="headerlink" title="Case Study"></a>Case Study</h2><h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>We are going to find the loaded modules of a simple program using winDbg to inspect them easily.</p>
<h3 id="Hands-On"><a href="#Hands-On" class="headerlink" title="Hands On"></a>Hands On</h3><p>Open winDbg and attach a debugger on some process, and execute the following command to obtain <code>TEB</code> information, in my case:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_TEB <span class="number">0x003e0000</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> NtTib            : _NT_TIB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> EnvironmentPointer : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x020</span> ClientId         : _CLIENT_ID</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x028</span> ActiveRpcHandle  : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> ThreadLocalStoragePointer : <span class="number">0x0063c340</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x030</span> ProcessEnvironmentBlock : <span class="number">0x003dd000</span> _PEB</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> LastErrorValue   : <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x038</span> CountOfOwnedCriticalSections : <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x03c</span> CsrClientThread  : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x040</span> Win32ThreadInfo  : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x044</span> User32Reserved   : [<span class="number">26</span>] <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x0ac</span> UserReserved     : [<span class="number">5</span>] <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x0c0</span> WOW32Reserved    : <span class="number">0x77817000</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x0c4</span> CurrentLocale    : <span class="number">0x410</span></span><br><span class="line"></span><br><span class="line">   ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p>Now we can access and analyze the <code>PEB</code> structure using the address stored in the <code>PEB Address</code> field typing the following command:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_PEB <span class="number">0x003dd000</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> InheritedAddressSpace : <span class="number">0</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x001</span> ReadImageFileExecOptions : <span class="number">0</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x002</span> BeingDebugged    : <span class="number">0x1</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> BitField         : <span class="number">0</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> ImageUsesLargePages : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsProtectedProcess : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsImageDynamicallyRelocated : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> SkipPatchingUser32Forwarders : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsPackagedProcess : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsAppContainer   : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsProtectedProcessLight : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x003</span> IsLongPathAwareProcess : 0y0</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x004</span> Mutant           : <span class="number">0xffffffff</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> ImageBaseAddress : <span class="number">0x00400000</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x00c</span> Ldr              : <span class="number">0x77945d80</span> _PEB_LDR_DATA</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x010</span> ProcessParameters : <span class="number">0x006323d0</span> _RTL_USER_PROCESS_PARAMETERS</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x014</span> SubSystemData    : (null) </span><br><span class="line"></span><br><span class="line">   ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p>Now remember that ldr field stores the address of <code>_PEB_LDR_DATA</code> data structure that contains informations about the loaded modules for this process.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_PEB_LDR_DATA <span class="number">0x77945d80</span> </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> Length           : <span class="number">0x30</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x004</span> Initialized      : <span class="number">0x1</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> SsHandle         : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x00c</span> InLoadOrderModuleList : _LIST_ENTRY [ <span class="number">0x634498</span> - <span class="number">0x63b8c8</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x014</span> InMemoryOrderModuleList : _LIST_ENTRY [ <span class="number">0x6344a0</span> - <span class="number">0x63b8d0</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> InInitializationOrderModuleList : _LIST_ENTRY [ <span class="number">0x6343a0</span> - <span class="number">0x634888</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x024</span> EntryInProgress  : (null) </span><br><span class="line"></span><br><span class="line">   +<span class="number">0x028</span> ShutdownInProgress : <span class="number">0</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> ShutdownThreadId : (null) </span><br></pre></td></tr></table></figure>

<p>Now it’s equal to choose to follow the <code>InLoadOrderModuleList</code> or <code>InMemoryOrderModuleList</code>, in this case I choosed to follow <code>InMemoryOrderModuleList</code>, it could be a good exercise shows that these lists are equivalents.</p>
<p>So it’s important now to remember what I said before, when we use the <code>InMemoryOrderLinks</code> we need to subtract 8bytes if we are in a 32bit environment, because otherwise we encounter the following problem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_LDR_DATA_TABLE_ENTRY <span class="number">0x6344a0</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x000</span> InLoadOrderLinks : _LIST_ENTRY [ <span class="number">0x634398</span> - <span class="number">0x77945d94</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x008</span> InMemoryOrderLinks : _LIST_ENTRY [ <span class="number">0x0</span> - <span class="number">0x0</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x010</span> InInitializationOrderLinks : _LIST_ENTRY [ <span class="number">0x400000</span> - <span class="number">0x4b8f6b</span> ]</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x018</span> DllBase          : <span class="number">0x0013f000</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x01c</span> EntryPoint       : <span class="number">0x00760074</span> Void</span><br><span class="line"></span><br><span class="line">   +<span class="number">0x020</span> SizeOfImage      : <span class="number">0x632898</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x024</span> FullDllName      : _UNICODE_STRING <span class="string">&quot;ac_client.exe&quot;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x02c</span> BaseDllName      : _UNICODE_STRING <span class="string">&quot;--- memory read error at address 0x0000ffff ---&quot;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> FlagGroup        : [<span class="number">4</span>]  <span class="string">&quot;???&quot;</span></span><br><span class="line"></span><br><span class="line">   +<span class="number">0x034</span> Flags            : <span class="number">0x77945be0</span></span><br></pre></td></tr></table></figure>

<p> You can see that the structure is incoerent, we can also deduce that <code>FullDllName</code> contains the value of <code>BaseDllName</code> so probably the structure was shifted of a number of bytes equals to 0x2c - 0x24 &#x3D; 8, cool! We demonstrate that to allineate correctly the structure we need to subtract 8 bytes</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_LDR_DATA_TABLE_ENTRY (<span class="number">0x6344a0</span> - <span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x000</span> InLoadOrderLinks : _LIST_ENTRY [ <span class="number">0x634390</span> - <span class="number">0x77945d8c</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x008</span> InMemoryOrderLinks : _LIST_ENTRY [ <span class="number">0x634398</span> - <span class="number">0x77945d94</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x010</span> InInitializationOrderLinks : _LIST_ENTRY [ <span class="number">0x0</span> - <span class="number">0x0</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x018</span> DllBase          : <span class="number">0x00400000</span> Void</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x01c</span> EntryPoint       : <span class="number">0x004b8f6b</span> Void</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x020</span> SizeOfImage      : <span class="number">0x13f000</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x024</span> FullDllName      : _UNICODE_STRING <span class="string">&quot;C:\Program Files (x86)\AssaultCube\bin_win32\ac_client.exe&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x02c</span> BaseDllName      : _UNICODE_STRING <span class="string">&quot;ac_client.exe&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> FlagGroup        : [<span class="number">4</span>]  <span class="string">&quot;???&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> Flags            : <span class="number">0x800022cc</span></span><br><span class="line"></span><br><span class="line">  ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p> Now we can see that the structure seems correct, if we follow the linked list we would obtain the following modules, let’s try to extract the following modules!</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_LDR_DATA_TABLE_ENTRY (<span class="number">0x634398</span> - <span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x000</span> InLoadOrderLinks : _LIST_ENTRY [ <span class="number">0x634878</span> - <span class="number">0x634498</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x008</span> InMemoryOrderLinks : _LIST_ENTRY [ <span class="number">0x634880</span> - <span class="number">0x6344a0</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x010</span> InInitializationOrderLinks : _LIST_ENTRY [ <span class="number">0x634c58</span> - <span class="number">0x77945d9c</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x018</span> DllBase          : <span class="number">0x77820000</span> Void</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x01c</span> EntryPoint       : (null) </span><br><span class="line"></span><br><span class="line">  +<span class="number">0x020</span> SizeOfImage      : <span class="number">0x1a3000</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x024</span> FullDllName      : _UNICODE_STRING <span class="string">&quot;C:\WINDOWS\SYSTEM32\ntdll.dll&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x02c</span> BaseDllName      : _UNICODE_STRING <span class="string">&quot;ntdll.dll&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> FlagGroup        : [<span class="number">4</span>]  <span class="string">&quot;???&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> Flags            : <span class="number">0xa2c4</span></span><br><span class="line"></span><br><span class="line">  ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p> We can clearly see that the second loaded module is the <code>ntdll.dll</code>, in fact this is the Windows core library and it should be loaded before any other dll libraries, except <code>ntoskrnl.dll</code>.</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">000</span>&gt; dt ntdll!_LDR_DATA_TABLE_ENTRY (<span class="number">0x634880</span> - <span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x000</span> InLoadOrderLinks : _LIST_ENTRY [ <span class="number">0x634c48</span> - <span class="number">0x634390</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x008</span> InMemoryOrderLinks : _LIST_ENTRY [ <span class="number">0x634c50</span> - <span class="number">0x634398</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x010</span> InInitializationOrderLinks : _LIST_ENTRY [ <span class="number">0x77945d9c</span> - <span class="number">0x634c58</span> ]</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x018</span> DllBase          : <span class="number">0x762a0000</span> Void</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x01c</span> EntryPoint       : <span class="number">0x762bf640</span> Void</span><br><span class="line"></span><br><span class="line">  +<span class="number">0x020</span> SizeOfImage      : <span class="number">0xf0000</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x024</span> FullDllName      : _UNICODE_STRING <span class="string">&quot;C:\WINDOWS\System32\KERNEL32.DLL&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x02c</span> BaseDllName      : _UNICODE_STRING <span class="string">&quot;KERNEL32.DLL&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> FlagGroup        : [<span class="number">4</span>]  <span class="string">&quot;???&quot;</span></span><br><span class="line"></span><br><span class="line">  +<span class="number">0x034</span> Flags            : <span class="number">0xca2cc</span></span><br><span class="line"></span><br><span class="line">  ... &lt;more&gt; ...</span><br></pre></td></tr></table></figure>

<p>The third loaded module is <code>Kernel32.dll</code>, keep in mind that the modules are loaded following this pattern:</p>
<ul>
<li><p>Exe module </p>
</li>
<li><p>ntdll.dll</p>
</li>
<li><p>kernel32.dll</p>
</li>
</ul>
<p>The rest of the modules depends on the program flow, dependencies, ecc.., it’s very important this concept because the majority of the shellcode that I analyze always retrieve the base address of the kernel32.dll module in order to call i.e. <code>GetProcAddress</code>, <code>LoadLibrary</code>.</p>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h2><p>Understand the way Processes and Threads are represented helps analyzing malicious code, but also writing efficient code from a programming perspective.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Understanding the Windows PEB</p><p><a href="http://example.com/2022/02/12/2022-02-12-PEB/">http://example.com/2022/02/12/2022-02-12-PEB/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Stefano De Rosa</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-02-12</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-08-22</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=64e4c5da4265f4001221c982&amp;product=inline-share-buttons&amp;source=platform" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/17/2022-02-17-GetPDF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Cyberdefenders - GetPDF</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/01/31/2021-01-31-Maldoc/"><span class="level-item">Carrier files theory</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://example.com/2022/02/12/2022-02-12-PEB/';
            this.page.identifier = '2022/02/12/2022-02-12-PEB/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'personal-blog-u9zciprq1a' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/CaptWake" alt="Stefano De Rosa"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Stefano De Rosa</p><p class="is-size-6 is-block">Cybersecurity, Machine Learning</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Italy</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/CaptWake" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/CaptWake"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/x00Bug"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:stefano.derosa@proton.me"><i class="fas fa-envelope-square"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CTF-Write-Up/"><span class="level-start"><span class="level-item">CTF Write-Up</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Malware-Analysis/"><span class="level-start"><span class="level-item">Malware Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows-Internals/"><span class="level-start"><span class="level-item">Windows Internals</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-22T17:03:15.283Z">2023-08-22</time></p><p class="title"><a href="/2023/08/22/hello-world/">Hello World</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-22T13:15:15.000Z">2023-08-22</time></p><p class="title"><a href="/2023/08/22/My-New-Post/">My New Post</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-17T00:00:00.000Z">2022-02-17</time></p><p class="title"><a href="/2022/02/17/2022-02-17-GetPDF/">Cyberdefenders - GetPDF</a></p><p class="categories"><a href="/categories/CTF-Write-Up/">CTF Write-Up</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-12T00:00:00.000Z">2022-02-12</time></p><p class="title"><a href="/2022/02/12/2022-02-12-PEB/">Understanding the Windows PEB</a></p><p class="categories"><a href="/categories/Windows-Internals/">Windows Internals</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-31T00:00:00.000Z">2021-01-31</time></p><p class="title"><a href="/2021/01/31/2021-01-31-Maldoc/">Carrier files theory</a></p><p class="categories"><a href="/categories/Malware-Analysis/">Malware Analysis</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicons/favicon-16x16.png" alt="Personal Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Stefano De Rosa</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>